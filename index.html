<!DOCTYPE html>
<html lang="en">
<head>
    <title>Daily Star Suicide Data Visualization</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF8"> 
    <link rel="stylesheet" type="text/css" href="./css/dc.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="./css/mainstyles.css" />
</head>
<body> 

	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.js" type="text/javascript"></script>
    <script type="text/javascript" src="./js/d3.js"></script>
    <script type="text/javascript" src="./js/crossfilter.js"></script>
    <script type="text/javascript" src="./js/dc.js"></script>
	<script  type="text/javascript" src="./js/topojson.v1.min.js"></script>
	<h1>Daily Star Suicide Visualization</h1>
	


	<div id="chart-line-suicides"></div>
	<div class="viewer"  style="color:#0000FF"></div>
	<div class = "visualcontrols">
	  	<div id="chart-ring-year"></div>
		<div id="chart-ring-age-group"></div>
		<div id="chart-ring-gender"></div>
		<div id="chart-ring-profession"></div>
		<div id="chart-ring-methodology"></div>
		<div id="chart-ring-reason"></div>
	</div>
	<script type="text/javascript" src="./js/drawMap.js"></script>
	
    <script type="text/javascript">
    var distDim;
    var distSum;

	function print_filter(filter){
		var f=eval(filter);
		if (typeof(f.length) != "undefined") {}else{}
		if (typeof(f.top) != "undefined") {f=f.top(Infinity);}else{}
		if (typeof(f.dimension) != "undefined") {f=f.dimension(function(d) { return "";}).top(Infinity);}else{}
		console.log(filter+"("+f.length+") = "+JSON.stringify(f).replace("[","[\n\t").replace(/}\,/g,"},\n\t").replace("]","\n]"));
	} 

	function loadMapValues(filter){
		var f=eval(filter);
		if (typeof(f.length) != "undefined") {}else{}
		if (typeof(f.top) != "undefined") {f=f.top(Infinity);}else{}
		if (typeof(f.dimension) != "undefined") {f=f.dimension(function(d) { return "";}).top(Infinity);}else{}
		//console.log(filter+"("+f.length+") = "+JSON.stringify(f).replace("[","[\n\t").replace(/}\,/g,"},\n\t").replace("]","\n]"));
		var x= JSON.stringify(f).split("{\"key\":\"");
		for(var i=0;i<x.length;i++)
		{
			z =  x[i].split("\",\"value\":")
			if(z.length==2)
			{ z[1]=z[1].split("}")[0];Districts[z[0]]=parseInt(z[1]);}
		}
		redrawMap();
	}

	function getAgeGroup(age){
		if(age<15) return "<15";
		if(age<25) return "15-25";
		if(age<35) return "25-35";
		if(age<45) return "35-45";
		return "45<";
	}
	
	function getProfession(profession){
		if(profession=="housewife") return "Housewife";
		if(profession=="student") return "Student";
		if(profession=="housemaid") return "Housemaid";
		return profession;
	
	}
	
		
	function getMethodology(method){
		if(method=="hanging") return "Hanging";
		return method;
	
	}
	
	function getReason(reason){
		if(reason=="family feud" || reason=="Family fued") return "Family feud";
		if(reason=="-") return "not given";
		if(reason=="Not known") return "not given";
		return reason;
	
	}
	
  d3.csv("./data/output.csv", function (data2){
    var dateFormat = d3.time.format('%Y-%m-%d');
    var hitslineChart  = dc.barChart("#chart-line-suicides");
    data2.forEach(function(d){
      d.Date = dateFormat.parse(d.Date);
	  d.Year = d.Date.getFullYear();
	  d.AgeGroup = getAgeGroup(d.Age); 
	  d.Profession = getProfession(d.Profession);
	  d.Reason = getReason(d.Reason);
	  d.Methodology = getMethodology(d.Methodology);
	  


    });
      var ndx = crossfilter(data2);

  var dateDim = ndx.dimension(function(d) {return d.Date;});
  var minDate = dateDim.bottom(1)[0].Date;
  var maxDate = dateDim.top(1)[0].Date;
  console.log(minDate);
  console.log(maxDate);
  //var ageDim = ndx.dimension(function(d){return +d.Age;});
  var daySum = dateDim.group().reduceSum(function(d){return 1;});
  

  //print_filter("ageSum");
 // var hits = dateDim.group().reduceSum(function(d) {return d.Age;});
  var brush = d3.svg.brush();



  hitslineChart
    .width(800).height(100)
    .dimension(dateDim)
    .group(daySum)
    .x(d3.time.scale().domain([minDate,maxDate]))
    .yAxisLabel("Suicides")
   
    .brushOn(true)
    .on("filtered",function(){
     
      distDim = ndx.dimension(function(d) {return d.District;});
      distSum = distDim.group().reduceSum(function(d){return 1;});
      loadMapValues("distSum");
	  distDim.dispose();
	  distSum.dispose();
 
    })
    .on("postRedraw",function(){
    	      distDim = ndx.dimension(function(d) {return d.District;});
      distSum = distDim.group().reduceSum(function(d){return 1;});
      loadMapValues("distSum");
	  distDim.dispose();
	  distSum.dispose();
    });

	distDim = ndx.dimension(function(d) {return d.District;});
	distSum = distDim.group().reduceSum(function(d){return 1;});
  	loadMapValues("distSum");
	distDim.dispose();
	distSum.dispose();
	
	 
	var yearDim  = ndx.dimension(function(d) {return +d.Year;});
	var year_total = yearDim.group().reduceSum(function(d) {return 1;});

	var yearRingChart   = dc.pieChart("#chart-ring-year");
	yearRingChart
		.width(150).height(150)
		.dimension(yearDim)
		.group(year_total)
		.innerRadius(30); 
	
	var ageDim  = ndx.dimension(function(d) {return d.AgeGroup;});
	var age_total = ageDim.group().reduceSum(function(d) {return 1;});

	var ageGroupRingChart   = dc.pieChart("#chart-ring-age-group");
	ageGroupRingChart
		.width(150).height(150)
		.dimension(ageDim)
		.group(age_total)
		.innerRadius(30); 
	
	var genderDim  = ndx.dimension(function(d) {return d.Gender;});
	var gender_total = genderDim.group().reduceSum(function(d) {return 1;});

	var genderRingChart   = dc.pieChart("#chart-ring-gender");
	genderRingChart
		.width(150).height(150)
		.dimension(genderDim)
		.group(gender_total)
		.innerRadius(30); 
	
		
	var profDim  = ndx.dimension(function(d) {return d.Profession;});
	var prof_total = profDim.group().reduceSum(function(d) {return 1;});

	var profRingChart   = dc.pieChart("#chart-ring-profession");
	profRingChart
		.width(150).height(150)
		.dimension(profDim)
		.group(prof_total)
		.innerRadius(30); 
		
	var methodDim  = ndx.dimension(function(d) {return d.Methodology;});
	var method_total = methodDim.group().reduceSum(function(d) {return 1;});

	var methodRingChart   = dc.pieChart("#chart-ring-methodology");
	methodRingChart
		.width(150).height(150)
		.dimension(methodDim)
		.group(method_total)
		.innerRadius(30); 
	
	var reasonDim  = ndx.dimension(function(d) {return d.Reason;});
	var reason_total = reasonDim.group().reduceSum(function(d) {return 1;});
	var reasonRingChart   = dc.pieChart("#chart-ring-reason");
	reasonRingChart
		.width(150).height(150)
		.dimension(reasonDim)
		.group(reason_total)
		.innerRadius(30); 
		
	dc.renderAll();


  });

    </script>


</body>
</html>	